<% begin %>
<% wymagania = Hash.from_xml(@experiment.result)["request"]["functionalities"]["functionality"] %>
<% w_array = wymagania.sort{ |a,b| a["id"] <=> b["id"] } 
%>
<br>
<div>
<a id='toogle_opinion' href=\"javascript:void(0)\">Estymuj bezpieczeństwo usługi złożonej</a> | <a id='toogle_raport' href=\"javascript:void(0)\">Generuj raport szczegółowy</a> | <a id='toogle_xml' href=\"javascript:void(0)\">Pokaż wynik w xml</a> | <a href=\"<%= experiment_result_path(@experiment) %>\" target='_blank'>Pokaż wynik w xml w nowym oknie</a>
</div>
<br>
<div id='opinion' style='display:none;'>
</div>

<div id='raport' style='display:none;'>
<hr/>
 Raport szczegółowy (usługi kandydujące oraz wybrane - zaznaczone na zielono):
<% w_array.each do |w| %>
  <ul>
  Wymaganie <%= w["id"] %><br/>
  <% k_array = Array.new %>
  <% k_array <<= w["services"]["service"] %>
  <% k_array = k_array.flatten %> 
  <% k_array.each do |k| %>
    <li style='color: <%= k["chosen"]=="true" ? "green" : "black" %>'> 
      ID: <%=k["id"]%>, NAZWA: <%=k["name"]%>, KOSZT: <%=k["cost"]["value"]%>, CZAS <%=k["time"]["value"]%><br/>
      INPUT: <%=k["input"].to_a.join(",") %>, OUTPUT: <%=k["output"].to_a.join(",") %>, Chosen: <%= k["chosen"] %><br/>
    </li>
  <% end %>
  </ul>
<% end %>
</div>
<div id='xml' style='display:none;'>
<hr/>
 Wynik w xml:
 <br><br>
	<%= h(@experiment.result).gsub(/[\n ]&lt/, "<br>&lt") %>
</div>


<hr />
 Otrzymane usługi:
<ul>
<% w_array.each do |w| %>
  <li>
  Wymaganie <%= w["id"] %><br/>
  <% k_array = Array.new %>
  <% k_array <<= w["services"]["service"] %>
  <% k_array = k_array.flatten %> 
  <% k_array.each do |k| %>
    <% if k["chosen"]=="true" %>
      ID: <%=k["id"]%>, NAZWA: <%=k["name"]%>, KOSZT: <%=k["cost"]["value"]%>, CZAS <%=k["time"]["value"]%><br/>
      INPUT: <%= k["input"].to_a.join(",") %> , OUTPUT: <%= k["output"].to_a.join(",") %><br/>
    <% end %>
  <% end %>
  </li>
<% end %>
<br/>
</ul>
<% rescue %>
Brak/bledne wyniki.
<% end %>